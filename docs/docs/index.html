<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>SQL Joy - v0.1.0</title>
	<meta name="description" content="Documentation for SQL Joy - v0.1.0">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">SQL Joy - v0.1.0</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>SQL Joy - v0.1.0</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#build-serverless-apps-in-javascript-with-sql" id="build-serverless-apps-in-javascript-with-sql" style="color: inherit; text-decoration: none;">
					<h4>Build serverless apps in JavaScript with SQL</h4>
				</a>
				<p>SQL Joy is an <a href="#open-source-software">open/available source</a> serverless framework for creating JavaScript web applications with a PostgreSQL database.
					You query the database directly from the frontend app or call JavaScript functions which
					execute on the server platform. SQL Joy can work with React, Vue, Svelte, or any frontend framework.
					It is most comparable to <a href="https://github.com/sqljoy/sqljoy/blob/master/docs/pages/firebase.md">Firebase</a>,
				PostgREST, and Hasura. SQL Joy lets you ergonomically:</p>
				<p>Query from the browser:</p>
				<pre><code class="language-js"><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">results</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">sj</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #795E26">sql</span><span style="color: #A31515">`select * from users where id = </span><span style="color: #0000FF">${</span><span style="color: #001080">user</span><span style="color: #000000FF">.</span><span style="color: #001080">id</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">);</span>
</code></pre>
				<pre><code class="language-json"><span style="color: #000000">{</span><span style="color: #0451A5">&quot;id&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #0451A5">&quot;name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Luke Skywalker&quot;</span><span style="color: #000000">, </span><span style="color: #0451A5">&quot;email&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;skywalker@jedicouncil.galaxy&quot;</span><span style="color: #000000">}</span>
</code></pre>
				<p>Or call backend code:</p>
				<pre><code class="language-js"><span style="color: #008000">// all in frontend.js</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">API_ENDPOINT</span><span style="color: #000000"> = </span><span style="color: #A31515">&quot;http://example.com&quot;</span><span style="color: #000000">; </span>
<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">backendFunc</span><span style="color: #000000">(</span><span style="color: #001080">ctx</span><span style="color: #000000">, </span><span style="color: #001080">data</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">res</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">fetch</span><span style="color: #000000">(</span><span style="color: #0070C1">API_ENDPOINT</span><span style="color: #000000">, {</span><span style="color: #001080">method:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;POST&quot;</span><span style="color: #000000">, </span><span style="color: #001080">body:</span><span style="color: #000000"> </span><span style="color: #267F99">JSON</span><span style="color: #000000">.</span><span style="color: #795E26">stringify</span><span style="color: #000000">(</span><span style="color: #001080">data</span><span style="color: #000000">)});</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">res</span><span style="color: #000000">.</span><span style="color: #795E26">json</span><span style="color: #000000">();</span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">backendFunc</span><span style="color: #000000">(</span><span style="color: #001080">sj</span><span style="color: #000000">.</span><span style="color: #795E26">beginTx</span><span style="color: #000000">(), {</span><span style="color: #A31515">&quot;some&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;JSON&quot;</span><span style="color: #000000">});</span>
</code></pre>
				<p>There&#39;s no manual marshalling of data, no costly mental context switching between frontend and
					backend code bases in different languages. Code can be freely shared between frontend and backend
				without having to copy or move it. Read on to see how SQL Joy works.</p>
				<a href="#query-from-the-browser" id="query-from-the-browser" style="color: inherit; text-decoration: none;">
					<h4>Query from the browser</h4>
				</a>
				<p>Define a query using the sql template tag in JavaScript.</p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">query</span><span style="color: #000000"> = </span><span style="color: #795E26">sql</span><span style="color: #A31515">`SELECT * FROM users WHERE group = </span><span style="color: #0000FF">${</span><span style="color: #001080">group</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">;</span>
</code></pre>
				<p>That looks like asking for a SQL injection attack, but it&#39;s not a string substitution.
				It gets compiled into a query object which keeps the params separate.</p>
				<pre><code class="language-js"><span style="color: #000000">&gt; </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">query</span><span style="color: #000000">)</span>
</code></pre>
				<pre><code class="language-json"><span style="color: #000000">{</span><span style="color: #0451A5">&quot;query&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SELECT * FROM users WHERE group = $0&quot;</span><span style="color: #000000">, </span><span style="color: #0451A5">&quot;params&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TODO&quot;</span><span style="color: #000000">}</span>
</code></pre>
				<p>Executing the query is as simple as</p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">fs</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #001080">query</span><span style="color: #000000">);</span>
</code></pre>
				<p>The result is an iterator over JavaScript (JSON) objects</p>
				<pre><code class="language-js"><span style="color: #000000">&gt; </span><span style="color: #AF00DB">for</span><span style="color: #000000"> (</span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">user</span><span style="color: #000000"> </span><span style="color: #0000FF">of</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000">) {</span>
<span style="color: #000000">&gt;     </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">user</span><span style="color: #000000">);</span>
<span style="color: #000000">&gt; }</span>
</code></pre>
				<pre><code class="language-json"><span style="color: #000000">{</span><span style="color: #0451A5">&quot;id&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #0451A5">&quot;username&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;bob&quot;</span><span style="color: #000000">, </span><span style="color: #CD3131">...</span><span style="color: #000000">}</span>
</code></pre>
				<pre><code class="language-json"><span style="color: #000000">{</span><span style="color: #0451A5">&quot;id&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #0451A5">&quot;username&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;alice&quot;</span><span style="color: #000000">, </span><span style="color: #CD3131">...</span><span style="color: #000000">}</span>
</code></pre>
				<a href="#validation" id="validation" style="color: inherit; text-decoration: none;">
					<h4>Validation</h4>
				</a>
				<p>You can write insert or update queries the same way, but you&#39;re also going to want to
				place some additional restrictions on what data can be saved, beyond the restrictions of the schema.</p>
				<pre><code class="language-js"><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">isValidEmail</span><span style="color: #000000">(</span><span style="color: #001080">params</span><span style="color: #000000">, </span><span style="color: #001080">errors</span><span style="color: #000000">) {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">email</span><span style="color: #000000"> = </span><span style="color: #001080">param</span><span style="color: #000000">[</span><span style="color: #A31515">&quot;email&quot;</span><span style="color: #000000">];</span>
<span style="color: #000000">  </span><span style="color: #008000">// At minimum an email should be x@y.ab</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #0000FF">typeof</span><span style="color: #000000"> </span><span style="color: #001080">email</span><span style="color: #000000"> !== </span><span style="color: #A31515">&quot;string&quot;</span><span style="color: #000000"> || </span><span style="color: #001080">email</span><span style="color: #000000">.</span><span style="color: #001080">length</span><span style="color: #000000"> &lt; </span><span style="color: #098658">6</span><span style="color: #000000"> ||</span>
<span style="color: #000000">      </span><span style="color: #001080">email</span><span style="color: #000000">.</span><span style="color: #795E26">indexOf</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;@&#039;</span><span style="color: #000000">, </span><span style="color: #098658">1</span><span style="color: #000000">) &lt; </span><span style="color: #098658">0</span><span style="color: #000000"> || </span><span style="color: #001080">email</span><span style="color: #000000">.</span><span style="color: #795E26">indexOf</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;.&#039;</span><span style="color: #000000">, </span><span style="color: #098658">3</span><span style="color: #000000">) &lt; </span><span style="color: #098658">0</span><span style="color: #000000">) {</span>
<span style="color: #000000">      </span><span style="color: #001080">errors</span><span style="color: #000000">.</span><span style="color: #795E26">add</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;email&quot;</span><span style="color: #000000">, </span><span style="color: #A31515">&quot;please enter a valid email address&quot;</span><span style="color: #000000">);</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">email</span><span style="color: #000000"> = </span><span style="color: #A31515">&quot;not an email&quot;</span><span style="color: #000000">; </span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">changeEmail</span><span style="color: #000000"> = </span><span style="color: #795E26">sql</span><span style="color: #A31515">`UPDATE users SET email = </span><span style="color: #0000FF">${</span><span style="color: #001080">email</span><span style="color: #0000FF">}</span>
<span style="color: #A31515">                        WHERE id = %{SESSION.user_id}`</span><span style="color: #000000">;</span>

<span style="color: #008000">// throws a ValidationError</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">fs</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #001080">changeEmail</span><span style="color: #000000">, </span><span style="color: #001080">isValidEmail</span><span style="color: #000000">);</span>
</code></pre>
				<p>The isValidEmail function will run in the browser before sending the query, it will also run on
					the server before executing the query. Note the use of a <code>%{SESSION}</code> variable here which
					is replaced on the server-side with the value from the current user&#39;s session. This ensures
					the user may only modify their own email address. Validation functions can also change the
				types or values of parameters and can even run queries or call fetch.</p>
				<a href="#security" id="security" style="color: inherit; text-decoration: none;">
					<h4>Security</h4>
				</a>
				<p>We&#39;ve shown how SQL Joy protects against SQL injection attacks, and briefly touched on
					how server-side trusted data, such as session variables, can be included in a query
					defined in the frontend to restrict what rows can be returned in a query. It&#39;s not
					safe to execute arbitrary queries against the database from an untrusted environment
					like the browser - so how does SQL Joy seemingly accomplish that? It doesn&#39;t allow
				executing arbitrary queries. SQL Joy can only run queries that are whitelisted.</p>
				<p>The SQL Joy compiler replaces all queries with query objects. When the query is executed
					a secure hash representing that query is sent, along with the parameters. The server looks
				the hash up in the whitelist and executes the query only if it matches.</p>
				<p>As this would be overly restrictive, SQL Joy can also combine whitelisted
					queries and parts of queries to create seemingly dynamic queries - but all the
					allowed combinations were detected statically and whitelisted by the compiler.
					There aren&#39;t any queries allowed that haven&#39;t been explicitly created and
				approved by the developers.</p>
				<p>However, server backend functions have no such restrictions and can run
					whitelisted as well as truly dynamic queries and even construct queries from
				strings - but with great power comes great responsibility so be careful!</p>
				<a href="#transactions-dependant-queries-and-dynamic-queries" id="transactions-dependant-queries-and-dynamic-queries" style="color: inherit; text-decoration: none;">
					<h4>Transactions, dependant queries, and dynamic queries</h4>
				</a>
				<p>Generally it&#39;s an anti-pattern to hold transactions open in an interactive session split
					across a high latency link, such as between the browser and the server. Transactions hold
					locks and block other transactions, so you want them to run as quickly as possible. The
					ideal is to run all transactions inside stored procedures in the database. You can do that
					with SQL Joy, but it&#39;s not always practical for other reasons. The next best thing is to run
				your transaction close to the database. You can do that with backend server functions.</p>
				<p>Writing and calling a backend function is really simple, and brings back good memories of
				one of the things the Meteor framework did well:</p>
				<pre><code class="language-js"><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">transferBalance</span><span style="color: #000000">(</span><span style="color: #001080">ctx</span><span style="color: #000000">, </span><span style="color: #001080">fromAccount</span><span style="color: #000000">, </span><span style="color: #001080">toAccount</span><span style="color: #000000">, </span><span style="color: #001080">amount</span><span style="color: #000000">) {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">query</span><span style="color: #000000"> = </span><span style="color: #795E26">sql</span><span style="color: #A31515">`SELECT balance FROM accounts WHERE id = </span><span style="color: #0000FF">${</span><span style="color: #001080">fromAccount</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">ctx</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #001080">query</span><span style="color: #000000">);</span>
<span style="color: #000000">  </span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">existingBalance</span><span style="color: #000000"> = </span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #795E26">next</span><span style="color: #000000">().</span><span style="color: #001080">value</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">existingBalance</span><span style="color: #000000"> == </span><span style="color: #0000FF">null</span><span style="color: #000000"> || </span><span style="color: #001080">existingBalance</span><span style="color: #000000"> &lt; </span><span style="color: #001080">amount</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">throw</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">Error</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;insufficient balance&quot;</span><span style="color: #000000">);</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">  </span>
<span style="color: #000000">  </span><span style="color: #008000">// Credit the destination account</span>
<span style="color: #000000">  </span><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">account_id</span><span style="color: #000000"> = </span><span style="color: #001080">toAccount</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">update</span><span style="color: #000000"> = </span><span style="color: #795E26">sql</span><span style="color: #A31515">`UPDATE accounts SET balance = balance + </span><span style="color: #0000FF">${</span><span style="color: #001080">amount</span><span style="color: #0000FF">}</span>
<span style="color: #A31515">                     WHERE id = </span><span style="color: #0000FF">${</span><span style="color: #001080">account_id</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">ctx</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #001080">update</span><span style="color: #000000">);</span>
<span style="color: #000000">  </span>
<span style="color: #000000">  </span><span style="color: #008000">// Debit the source account</span>
<span style="color: #000000">  </span><span style="color: #001080">update</span><span style="color: #000000">.</span><span style="color: #001080">params</span><span style="color: #000000">[</span><span style="color: #A31515">&quot;account_id&quot;</span><span style="color: #000000">] = </span><span style="color: #001080">fromAccount</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #001080">update</span><span style="color: #000000">.</span><span style="color: #001080">params</span><span style="color: #000000">[</span><span style="color: #A31515">&quot;amount&quot;</span><span style="color: #000000">] = -</span><span style="color: #001080">amount</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">ctx</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #001080">update</span><span style="color: #000000">);</span>
<span style="color: #000000">  </span>
<span style="color: #000000">  </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">ctx</span><span style="color: #000000">.</span><span style="color: #795E26">commit</span><span style="color: #000000">();  </span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">fromAccount</span><span style="color: #000000"> = </span><span style="color: #098658">1401234</span><span style="color: #000000">;</span>
<span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">toAccount</span><span style="color: #000000"> = </span><span style="color: #098658">1409832</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">transferBalance</span><span style="color: #000000">(</span><span style="color: #001080">sj</span><span style="color: #000000">.</span><span style="color: #795E26">beginTx</span><span style="color: #000000">(), </span><span style="color: #001080">fromAccount</span><span style="color: #000000">, </span><span style="color: #001080">toAccount</span><span style="color: #000000">, </span><span style="color: #098658">100</span><span style="color: #000000">);</span>
</code></pre>
				<p>Here <code>transferBalance</code> executes on the server. The SQL Joy compiler lifts it completely
					out of the frontend and compiles it into the backend code bundle which is what you deploy.
					The call site at <code>await transferBalance</code> is turned into fetch invocation marshaling the
					arguments as JSON and unmarshalling the JSON result. You can tell you&#39;re looking at a
					backend function by the ctx first argument, and a backend call by the <code>sj.beginTx()</code> that
					you must pass as the first argument. It may seem slightly magical, but it&#39;s done this way
					so that if you add type annotations (e.g. TypeScript) then the compiler will check the
				parameter and return types, and ensure you called it correctly by passing <code>sj.beginTx()</code>.</p>
				<p>The compiler uses tree-shaking based on ES6 imports to lift functions out of the frontend.
					Any code only referenced by backend functions will be completely removed. Shared functions will
					be compiled into both frontend and backend. For this to work properly you must use ES6
					imports between your frontend components. You should be doing this anyway though, and
				most people are.</p>
				<p>The end result of this is you can use share code almost freely between the frontend and backend.
					This is still limited by differences between the frontend and backend environments - but
					we&#39;re working at adding standard web APIs to the backend to fill in the gaps. Unlike node,
				we don&#39;t add additional backend APIs, except for the special context object.</p>
				<p>What&#39;s interesting about this is you can put your backend API function
					in the same file as the component that calls it, or you can put them in adjacent files.
					When a developers needs to know what happens in a particular edge case, the code for
					the backend function is readily available and in the same language. In practice this
					leads to fewer developers getting stuck waiting for answers from the backend team, fewer
					meetings and disruptions via slack and email, and fewer bugs when developers didn&#39;t go
				to the effort to verify the behavior of the backend code.</p>
				<a href="#using-privileged-third-party-apis" id="using-privileged-third-party-apis" style="color: inherit; text-decoration: none;">
					<h4>Using privileged third party APIs</h4>
				</a>
				<p>One of the main tasks of a backend is to interact with privileged third-party APIs
					that can&#39;t be used from the frontend because they require you to enforce security
					around them. APIs like Stripe, Twilio, Mailgun, etc. You can do this in SQL Joy
				by using the same standard fetch function you&#39;re used to in the browser.</p>
				<pre><code class="language-js"><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">getAnswer</span><span style="color: #000000">(</span><span style="color: #001080">data</span><span style="color: #000000">) {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">response</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">fetch</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;https://example.com/answer&quot;</span><span style="color: #000000">, {</span>
<span style="color: #000000">    </span><span style="color: #001080">method:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;POST&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">headers:</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #A31515">&quot;Content-Type&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;application/json&quot;</span>
<span style="color: #000000">    },</span>
<span style="color: #000000">    </span><span style="color: #001080">redirect:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;error&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">body:</span><span style="color: #000000"> </span><span style="color: #267F99">JSON</span><span style="color: #000000">.</span><span style="color: #795E26">stringify</span><span style="color: #000000">(</span><span style="color: #001080">data</span><span style="color: #000000">)</span>
<span style="color: #000000">  });</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">response</span><span style="color: #000000">.</span><span style="color: #795E26">json</span><span style="color: #000000">();</span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">answerData</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">getAnswer</span><span style="color: #000000">({</span><span style="color: #A31515">&quot;answer&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #098658">42</span><span style="color: #000000">});</span>
</code></pre>
				<p>Server functions run on the <a href="https://deno.land/">Deno</a> runtime. The cloud service, when available, will
					use a strictly sandboxed version of Deno with some limitations in order to facilitate
				running untrusted code safely on our servers.</p>
				<p>Client libraries that work in the browser can usually be used without modification
					or polyfills. Client libraries that expect to work in a NodeJS environment
					likely will not work without polyfills. The community around Deno is really stepping up,
					and the compatibility story gets better by the day. However, you should prefer to
					use the REST APIs directly with fetch when possible, as it&#39;s more performant and
				produces more useful logging and metrics.</p>
				<p>We log fetch requests and responses, along with how long they take, which
					really can speed up debugging issues with third-party integrations or identifying
					performance bottlenecks. You can see at a glance when a third-party dependency goes
					down and for how long and use that to hold them accountable to their SLAs.
				These logs can be disabled in the configuration.</p>
				<a href="#design-considerations" id="design-considerations" style="color: inherit; text-decoration: none;">
					<h4>Design Considerations</h4>
				</a>
				<p>As any experienced software developers knows, the entities that make the most sense
					for storing your data into a database are not necessarily the same entities that
				make the most sense for using in a UI.</p>
				<p>However, SQL Joy is not an ORM. You can select arbitrary subsets of rows from
					various tables and combine them into one &quot;UI entity&quot; just like you might
					with a traditional backend. Remap those entities however you like, either on the frontend,
				or on the backend using views or server functions.</p>
				<p>Some astute readers may have noticed that exposing the database schema at
					the client layer has implications for backward compatibility. If you rename
					or remove a table or column, that would break existing sessions with the
					old JavaScript code and queries. You could mitigate this to some extent by
					using views, but SQL Joy employs a more direct solution. When you deploy
					new code to the server it sends a version changed event to all connected
					clients which will reload with the new, in sync, code and queries. Likewise,
					if a client tries to connect with an older version the same thing will
					happen during the opening handshake. This not only solves the schema problem,
					but it solves a whole related class of backward compatibility problems that
					are typical with traditional software stacks. Stop wasting time chasing down
				that long tail of unreproducible bugs.</p>
				<a href="#use-the-right-tool-for-the-job" id="use-the-right-tool-for-the-job" style="color: inherit; text-decoration: none;">
					<h4>Use the right tool for the job</h4>
				</a>
				<p>We gave you lots of reasons why you should give SQL Joy a try, but in the spirit of
					radical transparency, which is a guiding principle for us, it&#39;s also important to talk
				about where it may not the right tool for the job.</p>
				<p>If you are publishing an API for third parties to use, then your backend <em>is</em> the product. In
					that case you don&#39;t want to use SQL queries directly from the frontend because they&#39;re harder
					to make backwards compatible - and the REST API for developers not using SQL Joy would
					be awkward. The server function call API produces a fairly sensible REST API, but it still doesn&#39;t
					give you the discoverability of GraphQL or the flexibility of REST - and backwards compatibility
				is still an issue. So if your product <em>is</em> the backend, SQL Joy is likely not the right tool for the job.</p>
				<p>If you&#39;re using microservices for the backend, then having SQL Joy bypass the backend
					and interact with the database directly really breaks the design encapsulation
					that you&#39;re trying to achieve. You could still use modules to separate components
					similarly - but that takes discipline, and you&#39;ll be swimming upstream against the current.
					Microservices are a terrible idea for so many reasons, but if that&#39;s your particular hell,
				then adding SQL Joy to it is not going to improve things.</p>
				<a href="#the-sweet-spot" id="the-sweet-spot" style="color: inherit; text-decoration: none;">
					<h4>The Sweet Spot</h4>
				</a>
				<p>SQL Joy reduces a lot of boilerplate code, and reduces bugs by making it trivial to switch
					between frontend and backend code to ensure they&#39;re integrated correctly. When we have the
					cloud service available it will also provide a fully serverless runtime environment where
					you pay for what you use and don&#39;t have to worry about any of the tasks around server administration,
				monitoring, scaling, etc.</p>
				<p>However, the real sweet spot currently is that it&#39;s a technical workaround to an organizational
					problem that many people are unaware of. If you have separate frontend and backend teams it&#39;s
					terribly inefficient. You lose some 0-30% productivity at any point in time by
					having the suboptimal balance between frontend and backend developers. You&#39;ll never be lucky
					enough to have it balanced just right - and it changes over time. You also lose a tremendous
					amount of velocity (latency - not throughput) in delivering features. If you&#39;ve ever worked
				in such an environment you know that adding a new feature looks something like this:</p>
				<ul>
					<li>Have a series of cross-team meetings to sync on requirements</li>
					<li>Put backend and frontend tasks into the respective team backlogs</li>
					<li>Teams will prioritize the backlog items as they see fit</li>
					<li>Eventually a backend developer gets assigned the task and creates the API endpoint</li>
					<li>It gets code reviewed, merged, and deployed to staging/dev environment</li>
					<li>The frontend team can now begin to integrate it with their work</li>
					<li>The frontend team discovers there were some mismatches between what they expected and what was delivered</li>
					<li>More meetings to sync over the changes that need to happen, and the cycle repeats</li>
				</ul>
				<p>It&#39;s not unusual for this cycle to take anywhere from 2-8 weeks to complete a new feature.
					You don&#39;t have to understand the Build-Measure-Learn feedback loop from the Lean Startup to
					see why iteration at such a slow pace is devastating to the success of any software product.
					This is an organizational anti-pattern, but it&#39;s very common because it&#39;s tough to find
				developers with skills and experience running the full gamut of your software stack.</p>
				<p>With SQL Joy, you still have developers who are more comfortable doing frontend or backend
					development, but everyone can read, understand, and modify all the code. Rather than the
					terribly slow cycle above a frontend developer can mock up or even fully build the API
					they need, and reach out to an individual backend expert for advice or to complete
					the work. You can convert two backlogs into one and have all developers working on the
					highest priority work at any point in time. You have just one language to hire for
				and fewer specific skills and experience required. This is the promise of universal JavaScript.</p>
				<a href="#the-dream" id="the-dream" style="color: inherit; text-decoration: none;">
					<h4>The Dream</h4>
				</a>
				<p>The idea of universal JavaScript is not new, it&#39;s what motivated Ryan Dahl to create NodeJS
					and now Deno. Being able to share code seamlessly across the frontend and backend is
					really convenient, especially when it comes to validation. For security validation has
					always needed to be done in the backend, but for timely user-feedback it also needs to
				happen in the frontend.</p>
				<p>JavaScript has matured into a respectable language that borrows inspiration
					and modern features from languages like Python. It&#39;s the most popular programming
					language in the world by a wide margin because of its use in the browser. Additionally,
					with Microsoft having created TypeScript you can incrementally add an expressive and powerful type system to the language.
					JavaScript tooling has also dramatically improved and modern JavaScript runtimes like V8 produce
					very efficient code that is an order of magnitude faster than interpreted languages like
				Python and Ruby.</p>
				<p>With Deno smoothing out the differences between browser JavaScript and server JavaScript,
					the time has really come for universal JavaScript. SQL Joy allows frontend and backend code
					to cohabit and interoperate seamlessly without having to change how it&#39;s structure or move
				or copy code across boundaries. We hope it makes the dream of universal JavaScript more competitive.</p>
				<a href="#open-source-software" id="open-source-software" style="color: inherit; text-decoration: none;">
					<h4>Open Source Software</h4>
				</a>
				<p>It&#39;s important to be clear and honest about what parts of SQL Joy are open source under the OSI definition and what are not.
					The client library, server runtime library, and CLI tools / compiler are all OSI open source under
					the extremely permissive MIT license. The admin application is closed source and only free for small teams - but
					it is merely a convenience and not required to use SQL Joy. The server itself is licensed under
				the MIT License with <a href="https://commonsclause.com/">Commons Clause</a> rider.</p>
				<p>The Commons Clause rider prohibits selling the software or offering it as a paid service.
					It came about as a reaction to large cloud companies profiting off open-source software while giving
					nothing back. As a result, the server is available source software with most of the rights and freedoms of
					open source software, minus that one exception about being able to profit directly off it. One
				may of course sell other products or services built with SQL Joy.</p>
				<p>This is a balance we&#39;re trying to strike between giving as many rights and freedoms to
					developers as possible without also preventing us from creating a profitable business on
					top of it - which is what pays for the development and improvement of SQL Joy for everyone.
				The Commons Clause is a short, simple, and elegant solution to the greatest flaw of OSI licenses.  </p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Modules</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/sqljoy__client_.html">sqljoy (client)</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/sqljoy_runtime__server_.html">sqljoy-<wbr>runtime (server)</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>