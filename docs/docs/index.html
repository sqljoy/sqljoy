<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>SQL Joy - v0.1.0</title>
	<meta name="description" content="Documentation for SQL Joy - v0.1.0">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">SQL Joy - v0.1.0</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>SQL Joy - v0.1.0</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#build-serverless-apps-in-javascript-with-sql" id="build-serverless-apps-in-javascript-with-sql" style="color: inherit; text-decoration: none;">
					<h4>Build serverless apps in JavaScript with SQL</h4>
				</a>
				<p>SQL Joy is a serverless framework for creating JavaScript web applications with a PostgreSQL database.
					You query the database directly from the frontend app or call JavaScript functions which
					execute on the server platform. SQL Joy can work with React, Vue, Svelte, or any frontend framework.
				It is most <a href="#how-sql-joy-compares-with-alternatives">comparable</a> to Firebase, PostgREST, and Hasura. SQL Joy lets you ergonomically:</p>
				<p>SQL Joy is not yet released. You can <a href="https://danielkunz.typeform.com/to/zqLPQ0Kb">sign up here</a> for
				access to the beta program when it opens.</p>
				<p>Query from the browser:</p>
				<pre><code class="language-js"><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">results</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">sj</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #795E26">sql</span><span style="color: #A31515">`select * from users where id = </span><span style="color: #0000FF">${</span><span style="color: #001080">user</span><span style="color: #000000FF">.</span><span style="color: #001080">id</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">);</span>
</code></pre>
				<pre><code class="language-json"><span style="color: #000000">{</span><span style="color: #0451A5">&quot;id&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #0451A5">&quot;name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Luke Skywalker&quot;</span><span style="color: #000000">, </span><span style="color: #0451A5">&quot;email&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;skywalker@jedicouncil.galaxy&quot;</span><span style="color: #000000">}</span>
</code></pre>
				<p>Or call backend code:</p>
				<pre><code class="language-js"><span style="color: #008000">// all in frontend.js</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">API_ENDPOINT</span><span style="color: #000000"> = </span><span style="color: #A31515">&quot;http://example.com&quot;</span><span style="color: #000000">; </span>
<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">backendFunc</span><span style="color: #000000">(</span><span style="color: #001080">ctx</span><span style="color: #000000">, </span><span style="color: #001080">data</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">res</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">fetch</span><span style="color: #000000">(</span><span style="color: #0070C1">API_ENDPOINT</span><span style="color: #000000">, {</span><span style="color: #001080">method:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;POST&quot;</span><span style="color: #000000">, </span><span style="color: #001080">body:</span><span style="color: #000000"> </span><span style="color: #267F99">JSON</span><span style="color: #000000">.</span><span style="color: #795E26">stringify</span><span style="color: #000000">(</span><span style="color: #001080">data</span><span style="color: #000000">)});</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">res</span><span style="color: #000000">.</span><span style="color: #795E26">json</span><span style="color: #000000">();</span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">backendFunc</span><span style="color: #000000">(</span><span style="color: #001080">sj</span><span style="color: #000000">.</span><span style="color: #795E26">beginTx</span><span style="color: #000000">(), {</span><span style="color: #A31515">&quot;some&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;JSON&quot;</span><span style="color: #000000">});</span>
</code></pre>
				<p>There&#39;s no manual marshalling of data, no costly mental context switching between frontend and
					backend code bases in different languages. Code can be freely shared between frontend and backend
				without having to copy or move it. Read on to see how SQL Joy works.</p>
				<ul>
					<li><a href="#query-from-the-browser">Query from the browser</a></li>
					<li><a href="#validation">Validation</a></li>
					<li><a href="#security">Security</a></li>
					<li><a href="#transactions">Transactions</a></li>
					<li><a href="#using-third-party-apis">Using third party APIs</a></li>
					<li><a href="#design-considerations">Design Considerations</a></li>
					<li><a href="#how-sql-joy-compares-with-alternatives">How SQL Joy compares with alternatives</a></li>
					<li><a href="#the-promise-of-universal-javascript">The Promise of Universal JavaScript</a></li>
				</ul>
				<a href="#query-from-the-browser" id="query-from-the-browser" style="color: inherit; text-decoration: none;">
					<h4>Query from the browser</h4>
				</a>
				<p>Define a query using the sql template tag in JavaScript.</p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">query</span><span style="color: #000000"> = </span><span style="color: #795E26">sql</span><span style="color: #A31515">`SELECT * FROM users WHERE group = </span><span style="color: #0000FF">${</span><span style="color: #001080">group</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">;</span>
</code></pre>
				<p>That looks like asking for a SQL injection attack, but it&#39;s not a string substitution.
				It gets compiled into a query object which keeps the params separate.</p>
				<pre><code class="language-js"><span style="color: #000000">&gt; </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">query</span><span style="color: #000000">)</span>
</code></pre>
				<pre><code class="language-json"><span style="color: #000000">{</span><span style="color: #0451A5">&quot;query&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SELECT * FROM users WHERE group = $0&quot;</span><span style="color: #000000">, </span><span style="color: #0451A5">&quot;params&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TODO&quot;</span><span style="color: #000000">}</span>
</code></pre>
				<p>Executing the query is as simple as</p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">fs</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #001080">query</span><span style="color: #000000">);</span>
</code></pre>
				<p>The result is an iterator over JavaScript (JSON) objects</p>
				<pre><code class="language-js"><span style="color: #000000">&gt; </span><span style="color: #AF00DB">for</span><span style="color: #000000"> (</span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">user</span><span style="color: #000000"> </span><span style="color: #0000FF">of</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000">) {</span>
<span style="color: #000000">&gt;     </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">user</span><span style="color: #000000">);</span>
<span style="color: #000000">&gt; }</span>
</code></pre>
				<pre><code class="language-json"><span style="color: #000000">{</span><span style="color: #0451A5">&quot;id&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #0451A5">&quot;username&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;bob&quot;</span><span style="color: #000000">, </span><span style="color: #CD3131">...</span><span style="color: #000000">}</span>
</code></pre>
				<pre><code class="language-json"><span style="color: #000000">{</span><span style="color: #0451A5">&quot;id&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #0451A5">&quot;username&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;alice&quot;</span><span style="color: #000000">, </span><span style="color: #CD3131">...</span><span style="color: #000000">}</span>
</code></pre>
				<a href="#validation" id="validation" style="color: inherit; text-decoration: none;">
					<h4>Validation</h4>
				</a>
				<p>You can write insert or update queries the same way, but you&#39;re also going to want to
				place some additional restrictions on what data can be saved, beyond the restrictions of the schema.</p>
				<pre><code class="language-js"><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">isValidEmail</span><span style="color: #000000">(</span><span style="color: #001080">params</span><span style="color: #000000">, </span><span style="color: #001080">errors</span><span style="color: #000000">) {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">email</span><span style="color: #000000"> = </span><span style="color: #001080">param</span><span style="color: #000000">[</span><span style="color: #A31515">&quot;email&quot;</span><span style="color: #000000">];</span>
<span style="color: #000000">  </span><span style="color: #008000">// At minimum an email should be x@y.ab</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #0000FF">typeof</span><span style="color: #000000"> </span><span style="color: #001080">email</span><span style="color: #000000"> !== </span><span style="color: #A31515">&quot;string&quot;</span><span style="color: #000000"> || </span><span style="color: #001080">email</span><span style="color: #000000">.</span><span style="color: #001080">length</span><span style="color: #000000"> &lt; </span><span style="color: #098658">6</span><span style="color: #000000"> ||</span>
<span style="color: #000000">      </span><span style="color: #001080">email</span><span style="color: #000000">.</span><span style="color: #795E26">indexOf</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;@&#039;</span><span style="color: #000000">, </span><span style="color: #098658">1</span><span style="color: #000000">) &lt; </span><span style="color: #098658">0</span><span style="color: #000000"> || </span><span style="color: #001080">email</span><span style="color: #000000">.</span><span style="color: #795E26">indexOf</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;.&#039;</span><span style="color: #000000">, </span><span style="color: #098658">3</span><span style="color: #000000">) &lt; </span><span style="color: #098658">0</span><span style="color: #000000">) {</span>
<span style="color: #000000">      </span><span style="color: #001080">errors</span><span style="color: #000000">.</span><span style="color: #795E26">add</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;email&quot;</span><span style="color: #000000">, </span><span style="color: #A31515">&quot;please enter a valid email address&quot;</span><span style="color: #000000">);</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">email</span><span style="color: #000000"> = </span><span style="color: #A31515">&quot;not an email&quot;</span><span style="color: #000000">; </span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">changeEmail</span><span style="color: #000000"> = </span><span style="color: #795E26">sql</span><span style="color: #A31515">`UPDATE users SET email = </span><span style="color: #0000FF">${</span><span style="color: #001080">email</span><span style="color: #0000FF">}</span>
<span style="color: #A31515">                        WHERE id = %{SESSION.user_id}`</span><span style="color: #000000">;</span>

<span style="color: #008000">// throws a ValidationError</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">fs</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #001080">changeEmail</span><span style="color: #000000">, </span><span style="color: #001080">isValidEmail</span><span style="color: #000000">);</span>
</code></pre>
				<p>The isValidEmail function will run in the browser before sending the query, it will also run on
					the server before executing the query. Note the use of a <code>%{SESSION}</code> variable here which
					is replaced on the server-side with the value from the current user&#39;s session. This ensures
					the user may only modify their own email address. Validation functions can also change the
				types or values of parameters and can even run queries or call fetch.</p>
				<a href="#security" id="security" style="color: inherit; text-decoration: none;">
					<h4>Security</h4>
				</a>
				<p>We&#39;ve shown how SQL Joy protects against SQL injection attacks, and briefly touched on
					how server-side trusted data, such as session variables, can be included in a query
					defined in the frontend to restrict what rows can be returned in a query. It&#39;s not
					safe to execute arbitrary queries against the database from an untrusted environment
					like the browser - so how does SQL Joy seemingly accomplish that? It doesn&#39;t allow
				executing arbitrary queries. SQL Joy can only run queries that are whitelisted.</p>
				<p>The SQL Joy compiler replaces all queries with query objects. When the query is executed
					a secure hash representing that query is sent, along with the parameters. The server looks
				the hash up in the whitelist and executes the query only if it matches.</p>
				<p>As this would be overly restrictive, SQL Joy can also combine whitelisted
					queries and parts of queries to create seemingly dynamic queries - but all the
					allowed combinations were detected statically and whitelisted by the compiler.
					There aren&#39;t any queries allowed that haven&#39;t been explicitly created and
				approved by the developers.</p>
				<p>However, server backend functions have no such restrictions and can run
					whitelisted as well as truly dynamic queries and even construct queries from
				strings - but with great power comes great responsibility so be careful!</p>
				<a href="#transactions" id="transactions" style="color: inherit; text-decoration: none;">
					<h4>Transactions</h4>
				</a>
				<p>Generally it&#39;s an anti-pattern to hold transactions open in an interactive session split
					across a high latency link, such as between the browser and the server. Transactions hold
					locks and block other transactions, so you want them to run as quickly as possible. The
					ideal is to run all transactions inside stored procedures in the database. You can do that
					with SQL Joy, but it&#39;s not always practical for other reasons. The next best thing is to run
				your transaction close to the database. You can do that with backend server functions.</p>
				<p>Writing and calling a backend function is really simple, and brings back good memories of
				one of the things the Meteor framework did well:</p>
				<pre><code class="language-js"><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">transferBalance</span><span style="color: #000000">(</span><span style="color: #001080">ctx</span><span style="color: #000000">, </span><span style="color: #001080">fromAccount</span><span style="color: #000000">, </span><span style="color: #001080">toAccount</span><span style="color: #000000">, </span><span style="color: #001080">amount</span><span style="color: #000000">) {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">query</span><span style="color: #000000"> = </span><span style="color: #795E26">sql</span><span style="color: #A31515">`SELECT balance FROM accounts WHERE id = </span><span style="color: #0000FF">${</span><span style="color: #001080">fromAccount</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">ctx</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #001080">query</span><span style="color: #000000">);</span>
<span style="color: #000000">  </span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">existingBalance</span><span style="color: #000000"> = </span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #795E26">next</span><span style="color: #000000">().</span><span style="color: #001080">value</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">existingBalance</span><span style="color: #000000"> == </span><span style="color: #0000FF">null</span><span style="color: #000000"> || </span><span style="color: #001080">existingBalance</span><span style="color: #000000"> &lt; </span><span style="color: #001080">amount</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">throw</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">Error</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;insufficient balance&quot;</span><span style="color: #000000">);</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">  </span>
<span style="color: #000000">  </span><span style="color: #008000">// Credit the destination account</span>
<span style="color: #000000">  </span><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">account_id</span><span style="color: #000000"> = </span><span style="color: #001080">toAccount</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">update</span><span style="color: #000000"> = </span><span style="color: #795E26">sql</span><span style="color: #A31515">`UPDATE accounts SET balance = balance + </span><span style="color: #0000FF">${</span><span style="color: #001080">amount</span><span style="color: #0000FF">}</span>
<span style="color: #A31515">                     WHERE id = </span><span style="color: #0000FF">${</span><span style="color: #001080">account_id</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">ctx</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #001080">update</span><span style="color: #000000">);</span>
<span style="color: #000000">  </span>
<span style="color: #000000">  </span><span style="color: #008000">// Debit the source account</span>
<span style="color: #000000">  </span><span style="color: #001080">update</span><span style="color: #000000">.</span><span style="color: #001080">params</span><span style="color: #000000">[</span><span style="color: #A31515">&quot;account_id&quot;</span><span style="color: #000000">] = </span><span style="color: #001080">fromAccount</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #001080">update</span><span style="color: #000000">.</span><span style="color: #001080">params</span><span style="color: #000000">[</span><span style="color: #A31515">&quot;amount&quot;</span><span style="color: #000000">] = -</span><span style="color: #001080">amount</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">ctx</span><span style="color: #000000">.</span><span style="color: #795E26">executeQuery</span><span style="color: #000000">(</span><span style="color: #001080">update</span><span style="color: #000000">);</span>
<span style="color: #000000">  </span>
<span style="color: #000000">  </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">ctx</span><span style="color: #000000">.</span><span style="color: #795E26">commit</span><span style="color: #000000">();  </span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">fromAccount</span><span style="color: #000000"> = </span><span style="color: #098658">1401234</span><span style="color: #000000">;</span>
<span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">toAccount</span><span style="color: #000000"> = </span><span style="color: #098658">1409832</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">transferBalance</span><span style="color: #000000">(</span><span style="color: #001080">sj</span><span style="color: #000000">.</span><span style="color: #795E26">beginTx</span><span style="color: #000000">(), </span><span style="color: #001080">fromAccount</span><span style="color: #000000">, </span><span style="color: #001080">toAccount</span><span style="color: #000000">, </span><span style="color: #098658">100</span><span style="color: #000000">);</span>
</code></pre>
				<p>Here <code>transferBalance</code> executes on the server. The SQL Joy compiler lifts it completely
					out of the frontend and compiles it into the backend code bundle which is what you deploy.
					The call site at <code>await transferBalance</code> is turned into fetch invocation marshaling the
					arguments as JSON and unmarshalling the JSON result. You can tell you&#39;re looking at a
					backend function by the ctx first argument, and a backend call by the <code>sj.beginTx()</code> that
					you must pass as the first argument. It may seem slightly magical, but it&#39;s done this way
					so that if you add type annotations (e.g. TypeScript) then the compiler will check the
				parameter and return types, and ensure you called it correctly by passing <code>sj.beginTx()</code>.</p>
				<p>The compiler uses tree-shaking based on ES6 imports to lift functions out of the frontend.
					Any code only referenced by backend functions will be completely removed. Shared functions will
					be compiled into both frontend and backend. For this to work properly you must use ES6
					imports between your frontend components. You should be doing this anyway though, and
				most people are.</p>
				<p>The end result of this is you can use share code almost freely between the frontend and backend.
					This is still limited by differences between the frontend and backend environments - but
					we&#39;re working at adding standard web APIs to the backend to fill in the gaps. Unlike node,
				we don&#39;t add additional backend APIs, except for the special context object.</p>
				<p>What&#39;s interesting about this is you can put your backend API function
					in the same file as the component that calls it, or you can put them in adjacent files.
					When a developers needs to know what happens in a particular edge case, the code for
					the backend function is readily available and in the same language. In practice this
					leads to fewer developers getting stuck waiting for answers from the backend team, fewer
					meetings and disruptions via slack and email, and fewer bugs when developers didn&#39;t go
				to the effort to verify the behavior of the backend code.</p>
				<a href="#using-third-party-apis" id="using-third-party-apis" style="color: inherit; text-decoration: none;">
					<h4>Using third party APIs</h4>
				</a>
				<p>One of the main tasks of a backend is to interact with privileged third-party APIs
					that can&#39;t be used from the frontend because they require you to enforce security
					around them. APIs like Stripe, Twilio, Mailgun, etc. You can do this in SQL Joy
				by using the same standard fetch function you&#39;re used to in the browser.</p>
				<pre><code class="language-js"><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">getAnswer</span><span style="color: #000000">(</span><span style="color: #001080">data</span><span style="color: #000000">) {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">response</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">fetch</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;https://example.com/answer&quot;</span><span style="color: #000000">, {</span>
<span style="color: #000000">    </span><span style="color: #001080">method:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;POST&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">headers:</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #A31515">&quot;Content-Type&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;application/json&quot;</span>
<span style="color: #000000">    },</span>
<span style="color: #000000">    </span><span style="color: #001080">redirect:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;error&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">body:</span><span style="color: #000000"> </span><span style="color: #267F99">JSON</span><span style="color: #000000">.</span><span style="color: #795E26">stringify</span><span style="color: #000000">(</span><span style="color: #001080">data</span><span style="color: #000000">)</span>
<span style="color: #000000">  });</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">response</span><span style="color: #000000">.</span><span style="color: #795E26">json</span><span style="color: #000000">();</span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">answerData</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">getAnswer</span><span style="color: #000000">({</span><span style="color: #A31515">&quot;answer&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #098658">42</span><span style="color: #000000">});</span>
</code></pre>
				<p>Server functions run on the <a href="https://deno.land/">Deno</a> runtime. The cloud service, when available, will
					use a strictly sandboxed version of Deno with some limitations in order to facilitate
				running untrusted code safely on our servers.</p>
				<p>Client libraries that work in the browser can usually be used without modification
					or polyfills. Client libraries that expect to work in a NodeJS environment
					likely will not work without polyfills. The community around Deno is really stepping up,
					and the compatibility story gets better by the day. However, you should prefer to
					use the REST APIs directly with fetch when possible, as it&#39;s more performant and
				produces more useful logging and metrics.</p>
				<p>We log fetch requests and responses, along with how long they take, which
					really can speed up debugging issues with third-party integrations or identifying
					performance bottlenecks. You can see at a glance when a third-party dependency goes
					down and for how long and use that to hold them accountable to their SLAs.
				These logs can be disabled in the configuration.</p>
				<a href="#design-considerations" id="design-considerations" style="color: inherit; text-decoration: none;">
					<h4>Design Considerations</h4>
				</a>
				<p>As any experienced software developers knows, the entities that make the most sense
					for storing your data into a database are not necessarily the same entities that
				make the most sense for using in a UI.</p>
				<p>However, SQL Joy is not an ORM. You can select arbitrary subsets of rows from
					various tables and combine them into one &quot;UI entity&quot; just like you might
					with a traditional backend. Remap those entities however you like, either on the frontend,
				or on the backend using views or server functions.</p>
				<p>Some astute readers may have noticed that exposing the database schema at
					the client layer has implications for backward compatibility. If you rename
					or remove a table or column, that would break existing sessions with the
					old JavaScript code and queries. You could mitigate this to some extent by
					using views, but SQL Joy employs a more direct solution. When you deploy
					new code to the server it sends a version changed event to all connected
					clients which will reload with the new, in sync, code and queries. Likewise,
					if a client tries to connect with an older version the same thing will
					happen during the opening handshake. This not only solves the schema problem,
					but it solves a whole related class of backward compatibility problems that
					are typical with traditional software stacks. Stop wasting time chasing down
				that long tail of unreproducible bugs.</p>
				<a href="#how-sql-joy-compares-with-alternatives" id="how-sql-joy-compares-with-alternatives" style="color: inherit; text-decoration: none;">
					<h4>How SQL Joy compares with alternatives</h4>
				</a>
				<p>We strongly value radical transparency and honesty, so we try hard to be impartial here.
					However, it&#39;s unavoidable that we&#39;re biased towards SQL Joy, and you should be extra careful to employ your critical
				thinking skills here.</p>
				<table>
					<thead>
						<tr>
							<th></th>
							<th>SQL Joy</th>
							<th>Firebase</th>
							<th>PostgREST</th>
							<th>Hasura</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>Database</td>
							<td>PostgreSQL</td>
							<td>NoSQL</td>
							<td>PostgreSQL</td>
							<td>PostgreSQL, SQL Server</td>
						</tr>
						<tr>
							<td>API</td>
							<td>SQL / JavaScript</td>
							<td>Client libraries</td>
							<td>REST</td>
							<td>GraphQL</td>
						</tr>
						<tr>
							<td>Lock-in</td>
							<td>Light</td>
							<td>Heavy</td>
							<td>Light</td>
							<td>Light</td>
						</tr>
						<tr>
							<td>Self hosted</td>
							<td>Yes</td>
							<td>No</td>
							<td>Yes</td>
							<td>Yes</td>
						</tr>
						<tr>
							<td>Cloud service</td>
							<td>Coming in 2022</td>
							<td>Only</td>
							<td>Supabase.io</td>
							<td>Yes</td>
						</tr>
						<tr>
							<td>Bring your own db</td>
							<td>Yes</td>
							<td>No</td>
							<td>Yes</td>
							<td>Yes</td>
						</tr>
						<tr>
							<td>Scalable</td>
							<td>Excellent</td>
							<td>If no data joins</td>
							<td>Normal</td>
							<td>Excellent</td>
						</tr>
						<tr>
							<td>Scale Horizontally</td>
							<td>Yes</td>
							<td>Yes</td>
							<td>Yes</td>
							<td>Yes</td>
						</tr>
						<tr>
							<td>Flexibility</td>
							<td>Excellent</td>
							<td>Poor</td>
							<td>Poor</td>
							<td>Good</td>
						</tr>
						<tr>
							<td>Real-time updates</td>
							<td>Soon</td>
							<td>Good</td>
							<td>No</td>
							<td>Excellent</td>
						</tr>
						<tr>
							<td>Open-source</td>
							<td><a href="https://github.com/sqljoy/sqljoy/issues/1">Not yet</a></td>
							<td>No</td>
							<td>Yes</td>
							<td>Yes</td>
						</tr>
						<tr>
							<td>Support</td>
							<td>Good</td>
							<td>Poor</td>
							<td>Community</td>
							<td>Good</td>
						</tr>
						<tr>
							<td>Price</td>
							<td>Free &lt; 3 devs</td>
							<td>By usage with free tier</td>
							<td>Free</td>
							<td>Free for self-hosted</td>
						</tr>
				</tbody></table>
				<p>Firebase is the most popular and has brand recognition as a Google Cloud service.
					If you&#39;re 100% certain your problem can be modelled for a NoSQL database, where
					you work with single objects or at most a range of objects of the same type,
					and you don&#39;t need to join between related objects of different types, then Firebase
					is a solid choice. If you&#39;re uncertain, or the requirements may change as your
					product grows and matures, then the heavy lock-in you&#39;ll find with Firebase
					could trap you into a solution that doesn&#39;t fit later on. Firebase is easy to get
					started with. The security rules is a nice feature, but often misused or configured in practice
					leading to a lot of data leaks. The likelihood you&#39;ll have to contort your data to fit both the
					limited NoSQL model, and the limited security rules, mean there&#39;s a high chance you&#39;ll
				end up regretting the decision in the future.</p>
				<p>Hasura is probably the next most popular. It&#39;s an excellent tool for creating a GraphQL
					API. You&#39;ll need to learn both SQL and GraphQL, but if your API is consumed by external
					developers, this is definitely the way to go. Running custom backend code is more awkward
					than SQL Joy, because that wasn&#39;t an initial design consideration. However, it has a lot of
					features and should cover most needs comfortably. It&#39;s a much better choice than Firebase.
					You&#39;ll need to enable the allow-list function and manually add all your queries to the allow-list
					and keep them in sync as you change them. Otherwise, bad actors can write pathological
					queries against your database that bring it down or access data you didn&#39;t secure correctly.
					In general there&#39;s more configuration needed with Hasura than SQL Joy, but it&#39;s also more
					flexible. If you need an external API we strongly recommend using Hasura in addition or
				instead of SQL Joy. If you use our cloud service, Hasura can be added with a few clicks.</p>
				<p>PostgREST is inferior in most ways to Hasura. It&#39;s less convenient, less flexible, and has
					fewer features. From our point of view there&#39;s no reason we would choose it over the others
					for a new project. It probably has appeal to people not wanting to learn GraphQL, but that&#39;s
					a mistake that will cost more in the long run. PostgREST is a fine product, but there are
				better options now.</p>
				<p>SQL Joy is the newest option and does not yet have all the features of the others. However,
					because it was designed from the start to allow custom backend code, that should be
					inconvenient rather than limiting when you run into a missing feature. It&#39;s easier to start with
					and configure than Hasura, and doesn&#39;t require that you use GraphQL. It&#39;s only for web and
					React Native applications. The others can be used with native mobile apps. We don&#39;t see
					ourselves in competition with Hasura, we offer it as part of our cloud service, and we&#39;ll
				integrate it more with SQL Joy over time to make the combination more convenient.</p>
				<a href="#the-promise-of-universal-javascript" id="the-promise-of-universal-javascript" style="color: inherit; text-decoration: none;">
					<h4>The promise of Universal JavaScript</h4>
				</a>
				<p>SQL Joy reduces a lot of boilerplate code, and reduces bugs by making it trivial to switch
					between frontend and backend code to ensure they&#39;re integrated correctly. When we have the
					cloud service available it will also provide a fully serverless runtime environment where
					you pay for what you use and don&#39;t have to worry about any of the tasks around server administration,
				monitoring, scaling, etc.</p>
				<p>If you have separate frontend and backend teams it&#39;s
					terribly inefficient. You lose up to 20% productivity at any point in time by
					having the suboptimal balance between frontend and backend developers. One is never lucky
					enough to have it balanced just right - and that ideal balance changes daily. You also lose a
					tremendous amount of velocity (latency - not throughput) in delivering features. If you&#39;ve ever
				worked in such an environment you know that adding a new feature looks something like this:</p>
				<ul>
					<li>Have a series of cross-team meetings to sync on requirements</li>
					<li>Put backend and frontend tasks into the respective team backlogs</li>
					<li>Teams will prioritize the backlog items as they see fit</li>
					<li>Eventually a backend developer gets assigned the task and creates the API endpoint</li>
					<li>It gets code reviewed, merged, and deployed to staging/dev environment</li>
					<li>The frontend team can now begin to integrate it with their work</li>
					<li>The frontend team discovers there were some mismatches between what they expected and what was delivered</li>
					<li>More meetings to sync over the changes that need to happen, and the cycle repeats</li>
				</ul>
				<p>It&#39;s not unusual for this cycle to take anywhere from 2-8 weeks to complete a new feature.
					You don&#39;t have to understand the Build-Measure-Learn feedback loop from the Lean Startup to
					see why iteration at such a slow pace is devastating to the success of any software product.
					This is an organizational anti-pattern, but it&#39;s very common because it&#39;s tough to find
				developers with skills and experience running the full gamut of your software stack.</p>
				<p>There will always developers who are more comfortable doing frontend or backend
					development - but with SQL Joy everyone can read, understand, and modify all the code.
					Rather than the kafkaesque cycle above, a frontend developer can mock up or even fully build
					the API they need, and reach out to an individual backend expert for advice or to complete
					the work. The two backlogs can be merged into one and all developers are free to do the
					highest priority work at any point in time. There is just one language to hire for
				and fewer specific skills and experience required. </p>
				<p>This is not unique to SQL Joy, this has long been the promise of universal JavaScript (using
					JavaScript on both the server and the client.)  It&#39;s what motivated Ryan Dahl to create NodeJS
					and now Deno. SQL Joy merely makes universal JavaScript applications easier and more pleasant
					to create and maintain. Being able to share code seamlessly across the frontend and backend is a
					productivity boon, especially when it comes to validation. For security, validation has always
					needed to be done in the backend, but for timely user-feedback it also needs to happen in the frontend.
				Keeping that logic in sync across different programming languages violates the DRY principle.</p>
				<p>JavaScript, historically the butt of many jokes, has matured into a respectable language that
					borrows inspiration and modern features from languages like Python. It&#39;s the most popular programming
					language in the world by a wide margin because of its use in the browser. With TypeScript,
					it&#39;s possible to incrementally add an expressive and powerful type system to the language.
					JavaScript tooling has also dramatically improved and modern JavaScript runtimes like V8 produce
					very efficient code that is an order of magnitude faster than interpreted languages like
				Python and Ruby.</p>
				<p>With Deno smoothing out the differences between browser JavaScript and server JavaScript,
					the time has really come for universal JavaScript. SQL Joy leverages Deno and allows
					frontend and backend code to cohabit and interoperate seamlessly without having move
					or copy code across boundaries. We hope it makes the dream of universal JavaScript more competitive.
					There is a massive advantage to be had in the reduction in mental context switching, in compartmentalizing of knowledge,
				in the amount of skills and knowledge required, and in overall complexity.</p>
				<a href="#get-early-access" id="get-early-access" style="color: inherit; text-decoration: none;">
					<h4>Get early access</h4>
				</a>
				<p>SQL Joy is not yet released. You can <a href="https://danielkunz.typeform.com/to/zqLPQ0Kb">sign up here</a> for
				access to the beta program when it opens.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Modules</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/sqljoy__client_.html">sqljoy (client)</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/sqljoy_runtime__server_.html">sqljoy-<wbr>runtime (server)</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>